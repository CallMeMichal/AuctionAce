@using AuctionAce.Api.Models.ViewModels.ItemViewModel
@model ItemViewModel
@{
    Layout = "~/Views/Shared/_LayoutLogged.cshtml";
    string userEmail = Context.Session.GetString("UserEmail");

}


<div class="container-fluid chat-container">
    <div class="chat-box" id="chatBox">
    </div>
    <div class="chat-input p-3">
        <input id="messageInput" type="text" class="form-control" placeholder="Type message..." />
        <button id="sendButton" class="btn btn-primary ms-2">Send</button>
    </div>
</div>


<script>
    $(document).ready(function () {
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/chathub")
            .build();

        const itemGuid = '@Model.Guid';

        connection.start()
            .then(() => {
                connection.invoke("JoinGroup", itemGuid)
                    .catch(err => console.error("Error joining group: ", err.toString()));
            })
            .catch(err => console.error("Error establishing connection: ", err.toString()));

        connection.on("ReceiveMessage", function (message,userEmail) {
            var messageElement = document.createElement("div");
            
            messageElement.className = "message";
            messageElement.textContent = `${userEmail}: ${message}`;
            document.getElementById("chatBox").appendChild(messageElement);
        });

        $('#sendButton').click(function () {
            const message = $('#messageInput').val();
            if (message) {
                const userEmail = '@userEmail';
                connection.invoke("SendMessageToGroup", itemGuid, message,userEmail)
                    .catch(err => console.error("Error sending message: ", err.toString()));
                $('#messageInput').val(''); // Wyczyść pole tekstowe po wysłaniu wiadomości
            }
        });
    });
</script>



<style>
    .chat-container {
        display: flex;
        flex-direction: column;
        height: 30vh;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
    }

    .chat-box {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        border: 1px solid #ddd;
        background-color: #f8f9fa;
    }

    .chat-input {
        display: flex;
        padding: 10px;
        background-color: #fff;
    }

        .chat-input input {
            flex: 1;
            margin-right: 10px;
        }

    .chat-box::-webkit-scrollbar {
        width: 8px;
    }

    .chat-box::-webkit-scrollbar-thumb {
        background-color: #888;
        border-radius: 10px;
    }

        .chat-box::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }
</style>