@using AuctionAce.Api.Models.ViewModels.Auctions
@model AuctionViewModel
@{
    string userIdString = Context.Session.GetString("UserId");
    int userId = 0;
    if (!string.IsNullOrEmpty(userIdString) && int.TryParse(userIdString, out userId))
    {
        Layout = "~/Views/Shared/_LayoutLogged.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/_LayoutUnlogged.cshtml";
    }

}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12 center" style="text-align:center">
            <h1>Current promotions</h1>
        </div>
    </div>

    <div class="row" id="auction-container">
        @if (Model.AuctionStatus != null)
        {
            foreach (var item in Model.AuctionStatus)
            {
                <div class="col-md-3">
                    <div class="card position-relative" data-status="@item.Status">
                        <div class="card position-relative" data-status="Status">
                            <img class="card-img-top" src="https://studentprawa.pl/media/k2/items/cache/af6038056f6231c664e3ef073c45af10_L.jpg" alt="Card image cap">
                            <div class="card-body">
                                <h5 class="card-title">@item.AuctionName</h5>
                                <p class="card-text">@item.Description</p>
                                <a href="@Url.Action("AuctionItemList", "Auction", new { auctionId = item.Id })" class="btn btn-primary">View Auction</a>
                            </div>
                            <div class="like-container">
                                <span class="like-icon" data-auction-id="@item.Id">&#9829;</span> <!-- Serduszko -->
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
    </div>
    <div class="row" style="margin-top:20px">
        <div class="d-grid gap-2 col-6 mx-auto">
            <button onclick="window.location.href = '@Url.Action("AllAuctions","Home")'" type="button" class="btn btn-primary btn-lg" style="margin-right:0px">See more</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var cards = document.querySelectorAll('.card');

        cards.forEach(function (card) {
            var statusValue = card.getAttribute('data-status');
            var statusBubble = document.createElement('div');
            statusBubble.classList.add('status-bubble');

            switch (statusValue) {
                case 'Active':
                    statusBubble.classList.add('status-open');
                    statusBubble.textContent = 'Active';
                    break;
                case 'Inactive':
                    statusBubble.classList.add('status-closed');
                    statusBubble.textContent = 'Inactive';
                    break;
                case 'Pending':
                    statusBubble.classList.add('status-pending');
                    statusBubble.textContent = 'Pending';
                    break;
            }

            card.appendChild(statusBubble);
        });

        // Event listener for like icons
        var likeIcons = document.querySelectorAll('.like-icon');

        likeIcons.forEach(function (icon) {
            icon.addEventListener('click', function () {
                var auctionId = this.getAttribute('data-auction-id');
                var isLiked = this.classList.contains('liked');

                // Toggle like state
                if (isLiked) {
                    this.classList.remove('liked');
                } else {
                    this.classList.add('liked');
                }

                // Update color
                this.style.color = isLiked ? 'gray' : 'red';

                // Send an AJAX request to save the like state to the server
                fetch('/like/auction', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ auctionId: auctionId, liked: !isLiked }),
                })
                    .then(response => response.json())
                    .then(data => {
                        // Handle response data if necessary
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            });
        });
    });

</script>

<style>
    .position-relative {
        position: relative;
    }

    .status-bubble {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 8px 12px;
        border-radius: 12px;
        color: white;
        font-weight: bold;
        text-align: center;
        font-size: 0.9rem;
        background: rgba(0, 0, 0, 0.7);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: background 0.3s ease;
    }

    .status-open {
        background-color: #28a745; /* green */
    }

    .status-closed {
        background-color: #dc3545; /* red */
    }

    .status-pending {
        background-color: #6c757d; /* gray */
    }

    .status-default {
        background-color: #007bff; /* blue */
    }

    .like-container {
        position: absolute;
        top: 10px;
        left: 10px;
    }

    .like-icon {
        font-size: 24px;
        cursor: pointer;
        color: gray;
        transition: color 0.3s ease;
    }

        .like-icon.liked {
            color: red;
        }
</style>
